<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<script src="static/d3.v5.js"></script>
  <script src="static/topojson-client.js"></script>
  <script src="static/d3-simple-slider.min.js"></script>
</head>

<body>
  <div>
    <!-- map -->
    <svg id="map" width="640" height="300"></svg>
  </div>
  <div class="row align-items-center">
    <div class="col-sm-2"><p id="value-time"></p></div>
    <div class="col-sm"><div id="slider-time"></div></div>
  </div>
</body>

<script>

// D3 Map
  // The svg
  let svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

  // Map and projection
  // projections: geoMercator, geoNaturalEarth1
  let projection = d3.geoMercator()
      .scale(80)
      .translate([width/2, height/2*1.24])

  // Create links / edges
  // tojson to escape special characters
  // we parse to convert string to object
  // let link = JSON.parse('{{ links | tojson }}');
  let link = [
    [{"coordinates": [[-79.63, 43.68], [-115.15, 36.08]], "type": "LineString"},
    {"coordinates": [[-82.53, 27.98], [-79.63, 43.68]], "type": "LineString"}],

    [{"coordinates": [[-60.63, 50.68], [-90.15, 50.08]], "type": "LineString"},
    {"coordinates": [[-90.53, 20.98], [-50.63, 33.68]], "type": "LineString"}]
    ];

  // Path generator
  let path = d3.geoPath()
      .projection(projection)

  // Load world shape
  d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/land-110m.json")
    .then(function(world) {

      // Draw map
      svg.insert("path", ".graticule")
          .datum(topojson.feature(world, world.objects.land))
          .attr("class", "land")
          .attr("d", path);

      // Add paths
      svg.selectAll("myPath")
        .data(link[0])
        .enter().append("path")
          .attr("class", "lines")  // need to specify class
          .attr("d", function(d){ return path(d)})
          .style("fill", "none")
          .style("stroke", "red")
          .style("stroke-width", 2)

  });

    // SLIDER
    
    // Time
  var dataTime = d3.range(0, 31);

  var sliderTime = d3
    .sliderBottom()
    .min(0)
    .max(30)
    .step(1)
    .width(svg.attr("width") - 60)
    // .tickFormat(d3.timeFormat('%Y'))
    .tickValues(dataTime)
    .default(0)
    .on('onchange', val => {
      d3.select('p#value-time').text(val);
      // add data
      svg.selectAll(".lines").remove();
      svg.selectAll("myPath")
        .data(link[val])
        .enter().append("path")
          .attr("class", "lines")  // need to specify class
          .attr("d", function(d){ return path(d)})
          .style("fill", "none")
          .style("stroke", "red")
          .style("stroke-width", 2);
    });

  var gTime = d3
    .select('div#slider-time')
    .append('svg')
    .attr('width', svg.attr("width"))
    .attr('height', 100)
    .append('g')
    .attr('transform', 'translate(30,30)');

  gTime.call(sliderTime);

  d3.select('p#value-time').text(sliderTime.value());

  d3.select('svg#myPath').data(link[sliderTime.value()]);
  // console.log(d3.select('svg#myPath').data(link[sliderTime.value()]));

</script>

</html>
